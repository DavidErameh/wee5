# WEE5 - Visual Specification Map

**Complete visual guide to WEE5 architecture, flows, and specifications**

---

## ğŸ“ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACES                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Experience  â”‚  â”‚   Dashboard  â”‚  â”‚   Discover   â”‚              â”‚
â”‚  â”‚     Page     â”‚  â”‚     Page     â”‚  â”‚     Page     â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Rank Card  â”‚  â”‚ - Analytics  â”‚  â”‚ - App Info   â”‚              â”‚
â”‚  â”‚ - Leaderboardâ”‚  â”‚ - XP Config  â”‚  â”‚ - Pricing    â”‚              â”‚
â”‚  â”‚              â”‚  â”‚ - Badges     â”‚  â”‚ - Features   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NEXT.JS APP ROUTER                            â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      API ROUTES                             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  /api/xp          /api/leaderboard    /api/webhook        â”‚    â”‚
â”‚  â”‚  /api/analytics   /api/xp-config      /api/enterprise     â”‚    â”‚
â”‚  â”‚  /api/checkout    /api/badges                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       BUSINESS LOGIC LAYER                           â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ XP Logic â”‚  â”‚ Rewards  â”‚  â”‚   Auth   â”‚  â”‚  Rate    â”‚           â”‚
â”‚  â”‚          â”‚  â”‚  System  â”‚  â”‚  System  â”‚  â”‚  Limit   â”‚           â”‚
â”‚  â”‚ - Award  â”‚  â”‚ - Check  â”‚  â”‚ - Verify â”‚  â”‚ - Check  â”‚           â”‚
â”‚  â”‚ - Calc   â”‚  â”‚ - Apply  â”‚  â”‚ - Tiers  â”‚  â”‚ - Track  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Event   â”‚  â”‚   Whop   â”‚  â”‚  Level   â”‚  â”‚  Badge   â”‚           â”‚
â”‚  â”‚Processor â”‚  â”‚   SDK    â”‚  â”‚  Utils   â”‚  â”‚  System  â”‚           â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚           â”‚
â”‚  â”‚ - Parse  â”‚  â”‚ - API    â”‚  â”‚ - Calc   â”‚  â”‚ - Award  â”‚           â”‚
â”‚  â”‚ - Valid  â”‚  â”‚ - Auth   â”‚  â”‚ - Prog   â”‚  â”‚ - Check  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATA LAYER                                  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Supabase PostgreSQL  â”‚         â”‚    Upstash Redis       â”‚     â”‚
â”‚  â”‚                        â”‚         â”‚                        â”‚     â”‚
â”‚  â”‚ Tables:                â”‚         â”‚ Keys:                  â”‚     â”‚
â”‚  â”‚ - users                â”‚         â”‚ - cooldown:{userId}    â”‚     â”‚
â”‚  â”‚ - rewards              â”‚         â”‚ - leaderboard:{expId}  â”‚     â”‚
â”‚  â”‚ - activity_log         â”‚         â”‚ - ratelimit:{key}      â”‚     â”‚
â”‚  â”‚ - xp_configurations    â”‚         â”‚                        â”‚     â”‚
â”‚  â”‚ - badges               â”‚         â”‚ TTL: 60s - 5min        â”‚     â”‚
â”‚  â”‚ - user_badges          â”‚         â”‚                        â”‚     â”‚
â”‚  â”‚                        â”‚         â”‚                        â”‚     â”‚
â”‚  â”‚ Features:              â”‚         â”‚ Features:              â”‚     â”‚
â”‚  â”‚ - Real-time subs       â”‚         â”‚ - Fast lookups         â”‚     â”‚
â”‚  â”‚ - RLS policies         â”‚         â”‚ - Atomic operations    â”‚     â”‚
â”‚  â”‚ - Indexes              â”‚         â”‚ - Expiration           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL SERVICES                               â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Whop   â”‚  â”‚  Sentry  â”‚  â”‚  Vercel  â”‚  â”‚  Stripe  â”‚           â”‚
â”‚  â”‚   API    â”‚  â”‚  Error   â”‚  â”‚ Hosting  â”‚  â”‚ Payment  â”‚           â”‚
â”‚  â”‚          â”‚  â”‚ Tracking â”‚  â”‚          â”‚  â”‚          â”‚           â”‚
â”‚  â”‚ - Events â”‚  â”‚ - Logs   â”‚  â”‚ - Deploy â”‚  â”‚ - Subs   â”‚           â”‚
â”‚  â”‚ - Users  â”‚  â”‚ - Alerts â”‚  â”‚ - Edge   â”‚  â”‚ - Billingâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ XP Award Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER ACTIVITY                                                 â”‚
â”‚    User posts message/post or gives reaction in Whop community  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. WHOP WEBHOOK                                                  â”‚
â”‚    Whop sends webhook event to /api/webhook                     â”‚
â”‚    - Event type: message.created, post.created, reaction.createdâ”‚
â”‚    - Includes: userId, experienceId, content, timestamp         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SIGNATURE VERIFICATION                                        â”‚
â”‚    Verify webhook signature using WHOP_WEBHOOK_SECRET           â”‚
â”‚    - Check x-whop-signature header                              â”‚
â”‚    - Verify timestamp (< 5 minutes old)                         â”‚
â”‚    - Reject if invalid                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. RATE LIMITING                                                 â”‚
â”‚    Check rate limit (10 requests/min per IP)                    â”‚
â”‚    - Redis key: webhook_ip:{ip}                                 â”‚
â”‚    - Increment counter                                          â”‚
â”‚    - Return 429 if exceeded                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. EVENT PROCESSING                                              â”‚
â”‚    Parse event and extract activity details                     â”‚
â”‚    - Determine activity type (message/post/reaction)            â”‚
â”‚    - Extract user and experience IDs                            â”‚
â”‚    - Validate data structure                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. COOLDOWN CHECK                                                â”‚
â”‚    Check if user is on cooldown (60 seconds)                    â”‚
â”‚    - Redis key: cooldown:{userId}                               â”‚
â”‚    - Return early if on cooldown                                â”‚
â”‚    - Continue if not on cooldown                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. XP CALCULATION                                                â”‚
â”‚    Calculate XP to award based on activity type                 â”‚
â”‚    - Message: 20 XP (fixed)                                     â”‚
â”‚    - Post: 15-25 XP (random)                                    â”‚
â”‚    - Reaction: 5 XP (fixed)                                     â”‚
â”‚    - Check for custom rates (Premium users)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. DATABASE UPDATE                                               â”‚
â”‚    Update user record in Supabase                               â”‚
â”‚    - Add XP to total                                            â”‚
â”‚    - Increment activity counter                                 â”‚
â”‚    - Calculate new level                                        â”‚
â”‚    - Update last_activity_at                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. LEVEL CHECK                                                   â”‚
â”‚    Check if user leveled up                                     â”‚
â”‚    - Compare old level vs new level                             â”‚
â”‚    - If leveled up, proceed to rewards                          â”‚
â”‚    - If not, skip to cooldown                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. REWARD SYSTEM (if level up)                                 â”‚
â”‚     Check if level has a reward                                 â”‚
â”‚     - Level 5: 3 free days                                      â”‚
â”‚     - Level 10: 7 free days                                     â”‚
â”‚     - Level 25: 14 free days                                    â”‚
â”‚     - Level 50: 30 free days                                    â”‚
â”‚     - Level 100: 50% discount                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. APPLY REWARD                                                 â”‚
â”‚     Apply reward via Whop API                                   â”‚
â”‚     - Add free days to membership                               â”‚
â”‚     - Or create promo code for discount                         â”‚
â”‚     - Record reward in database                                 â”‚
â”‚     - Send notification to user                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. SET COOLDOWN                                                 â”‚
â”‚     Set 60-second cooldown in Redis                             â”‚
â”‚     - Redis key: cooldown:{userId}                              â”‚
â”‚     - TTL: 60 seconds                                           â”‚
â”‚     - Prevents spam/abuse                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. ACTIVITY LOG                                                 â”‚
â”‚     Log activity for analytics                                  â”‚
â”‚     - Insert into activity_log table                            â”‚
â”‚     - Used for premium analytics                                â”‚
â”‚     - Helps track engagement                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. REAL-TIME UPDATE                                             â”‚
â”‚     Trigger Supabase real-time update                           â”‚
â”‚     - PostgreSQL triggers change notification                   â”‚
â”‚     - Subscribed clients receive update                         â”‚
â”‚     - UI updates automatically                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15. UI REFRESH                                                   â”‚
â”‚     React components update                                     â”‚
â”‚     - RankCard shows new XP/level                               â”‚
â”‚     - Leaderboard updates position                              â”‚
â”‚     - Progress bar animates                                     â”‚
â”‚     - Level-up toast notification (if applicable)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ® User Journey Map

### New User Journey

```
START â†’ Join Community â†’ First Activity â†’ Earn XP â†’ See Progress â†’ Continue Engaging
  â†“         â†“               â†“              â†“           â†“              â†“
Day 0    Day 0           Day 0          Day 0       Day 0          Day 1+
  â”‚         â”‚               â”‚              â”‚           â”‚              â”‚
  â”‚    Sees WEE5       Posts message   Gets 20 XP   Checks rank   Posts more
  â”‚    in community    or reaction     notification  card shows    activities
  â”‚                                                   progress
  â”‚
  â””â”€â†’ Views rank card in dashboard
      â””â”€â†’ Sees level 1, 20 XP, progress bar
          â””â”€â†’ Motivated to reach level 5 (reward)
```

### Engaged User Journey

```
Level 1 â†’ Level 5 â†’ Level 10 â†’ Level 25 â†’ Level 50 â†’ Level 100
  â†“         â†“          â†“           â†“          â†“           â†“
Day 1    Day 7      Day 30      Day 90     Day 180     Day 365
  â”‚         â”‚          â”‚           â”‚          â”‚           â”‚
  â”‚    3 free days  7 free days 14 free days 30 free days 50% discount
  â”‚    reward       reward       reward       reward       permanent
  â”‚
  â””â”€â†’ Checks leaderboard regularly
      â””â”€â†’ Competes for top 10
          â””â”€â†’ Shares achievements
```

### Premium User Journey

```
Free User â†’ Sees Analytics â†’ Upgrades to Premium â†’ Customizes XP â†’ Sees Results
    â†“            â†“                â†“                    â†“              â†“
  Using      Dashboard        Pays for            Adjusts rates   Engagement
  WEE5       shows basic      premium             for community   increases
             metrics          features            needs           40%
    â”‚            â”‚                â”‚                    â”‚              â”‚
    â”‚       Wants more       Gets access to      Sets higher     Community
    â”‚       detailed         XP config,          XP for posts    grows
    â”‚       analytics        analytics,          to encourage
    â”‚                        badges              content
```

### Enterprise User Journey

```
Single Community â†’ Multiple Communities â†’ Needs Management â†’ Upgrades Enterprise
       â†“                    â†“                    â†“                    â†“
   Using WEE5          Expands to 5+        Wants unified        Gets multi-
   successfully        communities          dashboard            community
                                                                 features
       â”‚                    â”‚                    â”‚                    â”‚
   Sees value          Manages each         Needs cross-        Can manage
   in engagement       separately           community           all from
                                           analytics            one place
```

---

## ğŸ“Š Data Flow Diagram

### Read Operations (Leaderboard)

```
User Request
    â†“
GET /api/leaderboard?experienceId=X&filter=week
    â†“
Rate Limit Check (Redis)
    â†“
Cache Check (Redis) â”€â”€â†’ Cache Hit? â”€â”€â†’ Return Cached Data
    â†“                                         â†‘
Cache Miss                                    â”‚
    â†“                                         â”‚
Query Database (Supabase)                     â”‚
    â†“                                         â”‚
Filter by timeframe                           â”‚
    â†“                                         â”‚
Order by XP DESC                              â”‚
    â†“                                         â”‚
Limit results                                 â”‚
    â†“                                         â”‚
Add rank numbers                              â”‚
    â†“                                         â”‚
Cache result (5 min TTL) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Return to client
```

### Write Operations (XP Award)

```
Webhook Event
    â†“
POST /api/webhook
    â†“
Signature Verification
    â†“
Rate Limit Check (Redis)
    â†“
Parse Event Data
    â†“
Cooldown Check (Redis) â”€â”€â†’ On Cooldown? â”€â”€â†’ Return 429
    â†“
Not on Cooldown
    â†“
Calculate XP
    â†“
Begin Transaction
    â†“
Update User Record (Supabase)
    â†“
Insert Activity Log (Supabase)
    â†“
Check Level Up
    â†“
Apply Reward (if applicable)
    â†“
Commit Transaction
    â†“
Set Cooldown (Redis, 60s TTL)
    â†“
Invalidate Cache (Redis)
    â†“
Trigger Real-time Update (Supabase)
    â†“
Return Success
```

---

## ğŸ—‚ï¸ Database Schema Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USERS TABLE                          â”‚
â”‚  Primary table for user XP/level tracking                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ user_id (TEXT, NOT NULL)                                    â”‚
â”‚ experience_id (TEXT, NOT NULL)                              â”‚
â”‚ xp (INTEGER, DEFAULT 0, CHECK >= 0)                         â”‚
â”‚ level (INTEGER, DEFAULT 1, CHECK >= 1)                      â”‚
â”‚ tier (TEXT, DEFAULT 'free', CHECK IN (...))                 â”‚
â”‚ total_messages (INTEGER, DEFAULT 0)                         â”‚
â”‚ total_posts (INTEGER, DEFAULT 0)                            â”‚
â”‚ total_reactions (INTEGER, DEFAULT 0)                        â”‚
â”‚ last_activity_at (TIMESTAMPTZ)                              â”‚
â”‚ created_at (TIMESTAMPTZ)                                    â”‚
â”‚ updated_at (TIMESTAMPTZ)                                    â”‚
â”‚                                                             â”‚
â”‚ UNIQUE(user_id, experience_id)                              â”‚
â”‚ INDEX ON user_id                                            â”‚
â”‚ INDEX ON experience_id                                      â”‚
â”‚ INDEX ON xp DESC (for leaderboards)                         â”‚
â”‚ INDEX ON (experience_id, xp DESC)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 1:N
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REWARDS TABLE                          â”‚
â”‚  Tracks earned rewards at milestone levels                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ user_id (TEXT, NOT NULL)                                    â”‚
â”‚ experience_id (TEXT, NOT NULL)                              â”‚
â”‚ level_achieved (INTEGER, NOT NULL)                          â”‚
â”‚ reward_type (TEXT, CHECK IN ('free_days', 'discount'))     â”‚
â”‚ reward_value (TEXT, NOT NULL)                              â”‚
â”‚ whop_membership_id (TEXT)                                   â”‚
â”‚ claimed_at (TIMESTAMPTZ)                                    â”‚
â”‚                                                             â”‚
â”‚ UNIQUE(user_id, experience_id, level_achieved)              â”‚
â”‚ INDEX ON user_id                                            â”‚
â”‚ INDEX ON experience_id                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACTIVITY_LOG TABLE                        â”‚
â”‚  Logs all XP-earning activities for analytics               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ user_id (TEXT, NOT NULL)                                    â”‚
â”‚ experience_id (TEXT, NOT NULL)                              â”‚
â”‚ activity_type (TEXT, CHECK IN (...))                        â”‚
â”‚ xp_awarded (INTEGER, NOT NULL)                              â”‚
â”‚ timestamp (TIMESTAMPTZ)                                     â”‚
â”‚                                                             â”‚
â”‚ INDEX ON user_id                                            â”‚
â”‚ INDEX ON experience_id                                      â”‚
â”‚ INDEX ON timestamp DESC                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 XP_CONFIGURATIONS TABLE                      â”‚
â”‚  Custom XP rates for premium communities                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ experience_id (TEXT, UNIQUE, NOT NULL)                      â”‚
â”‚ xp_per_message (INTEGER, CHECK 0-1000)                      â”‚
â”‚ min_xp_per_post (INTEGER, CHECK 0-1000)                     â”‚
â”‚ max_xp_per_post (INTEGER, CHECK 0-1000)                     â”‚
â”‚ xp_per_reaction (INTEGER, CHECK 0-1000)                     â”‚
â”‚ created_at (TIMESTAMPTZ)                                    â”‚
â”‚ updated_at (TIMESTAMPTZ)                                    â”‚
â”‚                                                             â”‚
â”‚ CHECK (max_xp_per_post >= min_xp_per_post)                  â”‚
â”‚ INDEX ON experience_id                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BADGES TABLE                            â”‚
â”‚  Custom badges for enterprise communities                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ experience_id (TEXT, NOT NULL)                              â”‚
â”‚ name (TEXT, NOT NULL)                                       â”‚
â”‚ description (TEXT)                                          â”‚
â”‚ image_url (TEXT, NOT NULL)                                  â”‚
â”‚ criteria (JSONB)                                            â”‚
â”‚ created_by (TEXT, NOT NULL)                                 â”‚
â”‚ created_at (TIMESTAMPTZ)                                    â”‚
â”‚ updated_at (TIMESTAMPTZ)                                    â”‚
â”‚                                                             â”‚
â”‚ INDEX ON experience_id                                      â”‚
â”‚ INDEX ON created_by                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 1:N
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER_BADGES TABLE                         â”‚
â”‚  Junction table for badge assignments                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID, PK)                                               â”‚
â”‚ user_id (TEXT, NOT NULL)                                    â”‚
â”‚ badge_id (UUID, FK â†’ badges.id)                             â”‚
â”‚ experience_id (TEXT, NOT NULL)                              â”‚
â”‚ awarded_at (TIMESTAMPTZ)                                    â”‚
â”‚ awarded_by (TEXT)                                           â”‚
â”‚                                                             â”‚
â”‚ UNIQUE(user_id, badge_id, experience_id)                    â”‚
â”‚ INDEX ON user_id                                            â”‚
â”‚ INDEX ON badge_id                                           â”‚
â”‚ INDEX ON experience_id                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Network Security
â”œâ”€ HTTPS only (enforced by Vercel)
â”œâ”€ CORS configuration
â””â”€ DDoS protection (Vercel)

Layer 2: Authentication
â”œâ”€ Whop SDK authentication
â”œâ”€ JWT token validation
â”œâ”€ Session management
â””â”€ Tier-based access control

Layer 3: API Security
â”œâ”€ Webhook signature verification
â”‚  â””â”€ HMAC SHA-256 with secret
â”œâ”€ Rate limiting (Redis)
â”‚  â”œâ”€ Per user: 5 req/min
â”‚  â”œâ”€ Per IP: 10 req/min
â”‚  â””â”€ Per endpoint: varies
â”œâ”€ Input validation (Zod)
â””â”€ Request size limits

Layer 4: Database Security
â”œâ”€ Row Level Security (RLS)
â”‚  â”œâ”€ Public read access
â”‚  â””â”€ Service role write access
â”œâ”€ Prepared statements (SQL injection prevention)
â”œâ”€ Connection encryption
â””â”€ Backup encryption

Layer 5: Data Security
â”œâ”€ Environment variable encryption
â”œâ”€ Secret rotation policy
â”œâ”€ No sensitive data in logs
â””â”€ PII handling compliance

Layer 6: Monitoring
â”œâ”€ Sentry error tracking
â”œâ”€ Audit logs
â”œâ”€ Anomaly detection
â””â”€ Security alerts
```

---

## ğŸ“ˆ Performance Optimization Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PERFORMANCE STRATEGIES                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Database Optimization
â”œâ”€ Indexes on frequently queried columns
â”‚  â”œâ”€ users.xp DESC (leaderboard)
â”‚  â”œâ”€ users.experience_id (filtering)
â”‚  â””â”€ activity_log.timestamp (analytics)
â”œâ”€ Connection pooling
â”œâ”€ Query optimization
â”‚  â”œâ”€ Limit result sets
â”‚  â”œâ”€ Avoid N+1 queries
â”‚  â””â”€ Use appropriate JOINs
â””â”€ Partitioning (future: activity_log by date)

Caching Strategy
â”œâ”€ Redis for hot data
â”‚  â”œâ”€ Leaderboards (5 min TTL)
â”‚  â”œâ”€ User cooldowns (60 sec TTL)
â”‚  â””â”€ Rate limits (1 min TTL)
â”œâ”€ CDN for static assets (Vercel)
â””â”€ Browser caching headers

API Optimization
â”œâ”€ Response compression (gzip)
â”œâ”€ Pagination for large datasets
â”œâ”€ Batch operations where possible
â””â”€ Async processing for heavy tasks

Frontend Optimization
â”œâ”€ Code splitting (Next.js automatic)
â”œâ”€ Image optimization (Next.js Image)
â”œâ”€ Lazy loading components
â”œâ”€ React Query for data caching
â””â”€ Optimistic UI updates

Real-time Optimization
â”œâ”€ Supabase subscriptions (efficient)
â”œâ”€ Debounced updates (500ms)
â”œâ”€ Selective re-renders
â””â”€ Connection pooling
```

---

## ğŸ¯ Feature Priority Matrix

```
                    HIGH IMPACT
                        â†‘
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â”‚   P0: MVP     â”‚  P1: Launch   â”‚
        â”‚               â”‚               â”‚
        â”‚ - XP System   â”‚ - XP Config   â”‚
        â”‚ - Leaderboard â”‚ - Analytics   â”‚
        â”‚ - Rank Cards  â”‚ - Rewards     â”‚
        â”‚ - Webhooks    â”‚               â”‚
        â”‚               â”‚               â”‚
LOW     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     HIGH
EFFORT  â”‚               â”‚               â”‚     EFFORT
        â”‚  P3: Future   â”‚  P2: Nice     â”‚
        â”‚               â”‚  to Have      â”‚
        â”‚ - Moderation  â”‚ - Badges      â”‚
        â”‚ - Bulk Ops    â”‚ - Admin Tools â”‚
        â”‚ - Custom Int  â”‚ - Multi-Comm  â”‚
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
                    LOW IMPACT
```

---

## ğŸš€ Deployment Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPLOYMENT FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Development
    â†“
Local Testing
    â”œâ”€ Unit tests
    â”œâ”€ Integration tests
    â””â”€ Manual testing
    â†“
Git Commit
    â†“
Push to GitHub
    â†“
Vercel Preview Deploy (automatic)
    â”œâ”€ Build Next.js app
    â”œâ”€ Run tests
    â”œâ”€ Deploy to preview URL
    â””â”€ Comment on PR with URL
    â†“
Code Review
    â”œâ”€ Review changes
    â”œâ”€ Test preview
    â””â”€ Approve/Request changes
    â†“
Merge to Main
    â†“
Vercel Production Deploy (automatic)
    â”œâ”€ Build Next.js app
    â”œâ”€ Run tests
    â”œâ”€ Deploy to production
    â””â”€ Update DNS
    â†“
Post-Deploy Checks
    â”œâ”€ Health check endpoints
    â”œâ”€ Smoke tests
    â”œâ”€ Monitor Sentry
    â””â”€ Check metrics
    â†“
Success âœ… or Rollback âŒ
```

---

**Spec Map Version:** 1.0  
**Last Updated:** January 2025  
**Status:** Complete
